<!DOCTYPE html>
<html lang="en">
<head>
    <meta charset="UTF-8">
    <meta name="viewport" content="width=device-width, initial-scale=1.0">
    <title>Dremel Tool Identifier</title>
    <style>
        /* ========== COLOR VARIABLES - EASY TO CUSTOMIZE ========== */
        :root {
            --primary-blue: #2563eb;
            --primary-blue-dark: #1e40af;
            --neutral-bg: #f8f9fa;
            --neutral-white: #ffffff;
            --neutral-gray: #6b7280;
            --neutral-light: #e5e7eb;
            --error-red: #ef4444;
        }

        * {
            margin: 0;
            padding: 0;
            box-sizing: border-box;
        }

        body {
            font-family: 'Segoe UI', Tahoma, Geneva, Verdana, sans-serif;
            background-color: var(--neutral-bg);
            min-height: 100vh;
            padding: 20px;
            display: flex;
            justify-content: center;
            align-items: center;
        }

        .container {
            background: var(--neutral-white);
            border-radius: 20px;
            box-shadow: 0 4px 20px rgba(0,0,0,0.08);
            max-width: 500px;
            width: 100%;
            overflow: hidden;
            position: relative;
        }

        .header {
            background: var(--neutral-white);
            color: var(--primary-blue);
            padding: 30px 20px;
            text-align: center;
            position: relative;
            border-bottom: 2px solid var(--neutral-light);
        }

        .header h1 {
            font-size: 26px;
            margin-bottom: 8px;
            font-weight: 700;
        }

        .header p {
            font-size: 14px;
            color: var(--neutral-gray);
        }

        .close-btn {
            position: absolute;
            top: 15px;
            right: 15px;
            width: 35px;
            height: 35px;
            background: var(--error-red);
            border: none;
            border-radius: 50%;
            color: white;
            font-size: 24px;
            cursor: pointer;
            display: none;
            align-items: center;
            justify-content: center;
            transition: all 0.3s;
            font-weight: 300;
            line-height: 1;
        }

        .close-btn:hover {
            background: #dc2626;
            transform: scale(1.1);
        }

        .close-btn.visible {
            display: flex;
        }

        .content {
            padding: 30px 20px;
        }

        .upload-section {
            text-align: center;
        }

        .upload-area {
            border: 3px dashed var(--neutral-light);
            border-radius: 15px;
            padding: 50px 30px;
            margin-bottom: 20px;
            cursor: pointer;
            transition: all 0.3s;
            background: var(--neutral-bg);
        }

        .upload-area:hover {
            border-color: var(--primary-blue);
            background: #eff6ff;
        }

        .upload-icon {
            font-size: 60px;
            margin-bottom: 15px;
        }

        .upload-area h3 {
            color: var(--primary-blue);
            margin-bottom: 8px;
            font-size: 18px;
        }

        .upload-area p {
            color: var(--neutral-gray);
            font-size: 14px;
        }

        .image-container {
            position: relative;
            width: 100%;
            max-width: 400px;
            margin: 0 auto 20px;
            border-radius: 15px;
            overflow: hidden;
            background: var(--neutral-bg);
            display: none;
        }

        #uploadedImage {
            width: 100%;
            max-height: 400px;
            object-fit: contain;
            display: block;
        }

        #fileInput {
            display: none;
        }

        .loading {
            text-align: center;
            padding: 40px 20px;
            display: none;
        }

        .spinner {
            border: 4px solid var(--neutral-light);
            border-top: 4px solid var(--primary-blue);
            border-radius: 50%;
            width: 50px;
            height: 50px;
            animation: spin 1s linear infinite;
            margin: 0 auto 15px;
        }

        @keyframes spin {
            0% { transform: rotate(0deg); }
            100% { transform: rotate(360deg); }
        }

        .loading p {
            color: var(--neutral-gray);
            font-size: 15px;
        }

        .result-section {
            display: none;
            animation: fadeIn 0.5s;
        }

        @keyframes fadeIn {
            from { opacity: 0; transform: translateY(20px); }
            to { opacity: 1; transform: translateY(0); }
        }

        .result-section.active {
            border: 3px solid var(--primary-blue);
            border-radius: 15px;
            padding: 20px;
            background: #eff6ff;
        }

        .result-header {
            background: var(--primary-blue);
            color: white;
            padding: 20px;
            border-radius: 12px;
            margin-bottom: 20px;
            text-align: center;
        }

        .result-header h2 {
            font-size: 28px;
            margin-bottom: 5px;
        }

        .confidence {
            font-size: 14px;
            opacity: 0.95;
        }

        .info-card {
            background: var(--neutral-white);
            border-radius: 12px;
            padding: 18px;
            margin-bottom: 12px;
            border-left: 4px solid var(--primary-blue);
            box-shadow: 0 2px 8px rgba(0,0,0,0.05);
        }

        .info-card h3 {
            color: var(--primary-blue);
            font-size: 16px;
            margin-bottom: 10px;
            display: flex;
            align-items: center;
            gap: 8px;
            font-weight: 600;
        }

        .info-card p {
            color: var(--neutral-gray);
            line-height: 1.6;
            font-size: 15px;
        }

        .icon {
            font-size: 20px;
        }

        .error-section {
            display: none;
            text-align: center;
            padding: 20px;
            animation: fadeIn 0.5s;
        }

        .error-icon {
            font-size: 60px;
            margin-bottom: 15px;
        }

        .error-section h2 {
            color: var(--error-red);
            margin-bottom: 10px;
            font-size: 22px;
        }

        .error-section p {
            color: var(--neutral-gray);
            line-height: 1.6;
            margin-bottom: 20px;
        }

        .error-section ul {
            text-align: left;
            margin: 0 auto 20px;
            max-width: 300px;
            color: var(--neutral-gray);
            line-height: 1.8;
        }

        .retry-btn {
            background: var(--primary-blue);
            color: white;
            padding: 12px 30px;
            border: none;
            border-radius: 25px;
            font-size: 16px;
            font-weight: 600;
            cursor: pointer;
            transition: all 0.3s;
            box-shadow: 0 4px 12px rgba(37, 99, 235, 0.3);
        }

        .retry-btn:hover {
            background: var(--primary-blue-dark);
            transform: translateY(-2px);
            box-shadow: 0 6px 16px rgba(37, 99, 235, 0.4);
        }

        @media (max-width: 480px) {
            .header h1 {
                font-size: 22px;
            }
            
            .upload-area {
                padding: 40px 20px;
            }
        }
    </style>
</head>
<body>
    <div class="container">
        <div class="header">
            <button class="close-btn" id="closeBtn">√ó</button>
            <h1>üõ†Ô∏è Dremel Tool Identifier</h1>
            <p>Identify your Dremel tool instantly</p>
        </div>

        <div class="content">
            <div class="upload-section" id="uploadSection">
                <div class="upload-area" id="uploadArea">
                    <div class="upload-icon">üì∏</div>
                    <h3>Take or Upload a Photo</h3>
                    <p>Click to take a photo or select from gallery</p>
                </div>
                
                <div class="image-container" id="imageContainer">
                    <img id="uploadedImage" alt="Uploaded tool">
                </div>

                <input type="file" id="fileInput" accept="image/*" capture="environment">
            </div>

            <div class="loading" id="loading">
                <div class="spinner"></div>
                <p>Analyzing your tool...</p>
            </div>

            <div class="error-section" id="errorSection">
                <div class="error-icon">‚ùå</div>
                <h2>Image Not Clear Enough</h2>
                <p>The model cannot recognize the tool clearly. Try taking a better photo with:</p>
                <ul>
                    <li>Better lighting</li>
                    <li>Tool closer to camera</li>
                    <li>Sharper focus</li>
                    <li>Less background clutter</li>
                </ul>
                <button class="retry-btn" onclick="resetApp()">Try Again</button>
            </div>

            <div class="result-section" id="resultSection">
                <div class="result-header">
                    <h2 id="toolName"></h2>
                    <p class="confidence" id="confidence"></p>
                </div>

                <div class="info-card">
                    <h3><span class="icon">‚öôÔ∏è</span> Function</h3>
                    <p id="function"></p>
                </div>

                <div class="info-card">
                    <h3><span class="icon">üî®</span> Materials</h3>
                    <p id="materials"></p>
                </div>

                <div class="info-card">
                    <h3><span class="icon">‚ö°</span> Rotation Speed</h3>
                    <p id="speed"></p>
                </div>
            </div>
        </div>
    </div>

    <script src="https://cdn.jsdelivr.net/npm/@tensorflow/tfjs@latest/dist/tf.min.js"></script>
    <script src="https://cdn.jsdelivr.net/npm/@teachablemachine/image@latest/dist/teachablemachine-image.min.js"></script>

    <script>
        // ========== CONFIGURATION - CHANGE THESE ==========
        const MODEL_URL = "https://teachablemachine.withgoogle.com/models/VQrr5Hp0O/";
        const CONFIDENCE_THRESHOLD = 0.50; // 50% - lower = more lenient
        
        // Tool information database - MUST match your Teachable Machine class names EXACTLY
        const toolInfo = {
            "Sanding": {
                function: "Removes material, smooths surfaces, removes paint.",
                materials: "Wood, fiberglass, rubber, soft metal.",
                speed: "Medium (10,000 ‚Äì 20,000 RPM)"
            },
            "Cutting": {
                function: "Cuts through bolts, screws, pipes, and sheet metal.",
                materials: "Metal, hard plastic, sometimes wood (with special disc).",
                speed: "High (30,000+ RPM)"
            },
            "Polishing": {
                function: "Polishes surfaces, cleans, removes scratches (use with polishing compound).",
                materials: "Silver, gold, brass, chrome, hard plastic.",
                speed: "Low (12,000 ‚Äì 15,000 RPM)"
            },
            "Grinding met...": {
                function: "Sharpens knives and screwdrivers, removes burrs from metal.",
                materials: "Ferrous metals (iron, steel).",
                speed: "Medium to High (20,000 ‚Äì 25,000 RPM)"
            },
            "Grinding sto...": {
                function: "Sharpens harder materials.",
                materials: "Glass, stone, ceramic, non-ferrous metals.",
                speed: "Medium to High (20,000 ‚Äì 25,000 RPM)"
            },
            "Engraving": {
                function: "Fine detail work, engraving names, creating patterns.",
                materials: "Wood, plastic, soft metals, leather.",
                speed: "High (maximum speed)"
            }
        };
        // ==================================================

        let model;

        async function loadModel() {
            try {
                const modelURL = MODEL_URL + "model.json";
                const metadataURL = MODEL_URL + "metadata.json";
                model = await tmImage.load(modelURL, metadataURL);
                console.log("Model loaded successfully");
            } catch (error) {
                console.error("Failed to load model:", error);
                alert("Failed to load AI model. Please check your internet connection and model URL.");
            }
        }

        async function analyzeImage(imageElement) {
            try {
                const predictions = await model.predict(imageElement);
                
                // Find highest confidence prediction
                let topPrediction = predictions[0];
                for (let i = 1; i < predictions.length; i++) {
                    if (predictions[i].probability > topPrediction.probability) {
                        topPrediction = predictions[i];
                    }
                }
                
                console.log(`Recognized: ${topPrediction.className} (${(topPrediction.probability * 100).toFixed(1)}%)`);
                return topPrediction;
            } catch (error) {
                console.error("Prediction failed:", error);
                throw error;
            }
        }

        function displayResult(prediction) {
            const className = prediction.className;
            const confidence = (prediction.probability * 100).toFixed(1);
            
            // Check if confidence is high enough
            if (prediction.probability < CONFIDENCE_THRESHOLD) {
                showError();
                return;
            }
            
            // Check if we have info for this tool
            const info = toolInfo[className];
            if (!info) {
                console.error(`No info found for class: "${className}"`);
                console.log("Available classes:", Object.keys(toolInfo));
                alert(`Tool recognized as "${className}" but no information available. Check class names in code.`);
                showError();
                return;
            }
            
            // Display results
            document.getElementById("toolName").textContent = className;
            document.getElementById("confidence").textContent = `Confidence: ${confidence}%`;
            document.getElementById("function").textContent = info.function;
            document.getElementById("materials").textContent = info.materials;
            document.getElementById("speed").textContent = info.speed;
            
            // Show result section
            document.getElementById("uploadSection").style.display = "none";
            document.getElementById("loading").style.display = "none";
            document.getElementById("errorSection").style.display = "none";
            document.getElementById("resultSection").style.display = "block";
            document.getElementById("resultSection").classList.add("active");
            document.getElementById("closeBtn").classList.add("visible");
        }

        function showError() {
            document.getElementById("uploadSection").style.display = "none";
            document.getElementById("loading").style.display = "none";
            document.getElementById("resultSection").style.display = "none";
            document.getElementById("errorSection").style.display = "block";
            document.getElementById("closeBtn").classList.add("visible");
        }

        function resetApp() {
            document.getElementById("imageContainer").style.display = "none";
            document.getElementById("uploadSection").style.display = "block";
            document.getElementById("resultSection").style.display = "none";
            document.getElementById("resultSection").classList.remove("active");
            document.getElementById("errorSection").style.display = "none";
            document.getElementById("loading").style.display = "none";
            document.getElementById("closeBtn").classList.remove("visible");
            document.getElementById("fileInput").value = "";
        }

        // Event Listeners
        document.getElementById("uploadArea").addEventListener("click", () => {
            document.getElementById("fileInput").click();
        });

        document.getElementById("fileInput").addEventListener("change", async (e) => {
            const file = e.target.files[0];
            if (!file) return;
            
            // Show loading
            document.getElementById("loading").style.display = "block";
            document.getElementById("uploadSection").style.display = "none";
            
            // Load model if not loaded
            if (!model) {
                await loadModel();
            }
            
            // Load and display image
            const reader = new FileReader();
            reader.onload = async (event) => {
                const img = document.getElementById("uploadedImage");
                img.src = event.target.result;
                document.getElementById("imageContainer").style.display = "block";
                
                // Wait for image to load, then analyze
                img.onload = async () => {
                    try {
                        const prediction = await analyzeImage(img);
                        displayResult(prediction);
                    } catch (error) {
                        console.error("Analysis error:", error);
                        alert("Error analyzing image: " + error.message);
                        showError();
                    }
                };
            };
            reader.readAsDataURL(file);
        });

        document.getElementById("closeBtn").addEventListener("click", resetApp);
    </script>
</body>
</html>
